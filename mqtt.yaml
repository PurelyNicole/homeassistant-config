# Fans
fan:
  - name: "Family Room Fan - South"
    qos: 1
    state_topic: "stat/family_room_south_fan/POWER"
    command_topic: "cmnd/family_room_south_fan/POWER"
    availability_topic: "tele/family_room_south_fan/LWT"
    percentage_state_topic: "stat/family_room_south_fan/speed"
    percentage_value_template: '{{ ((value | replace("3,","")) | int + 1) * 25 }}'
    percentage_command_topic: "cmnd/family_room_south_fan/tuyasend4"
    percentage_command_template: "3,{{ ((value | int - 1) / 25) | int }}"
    preset_mode_state_topic: "stat/family_room_south_fan/speed"
    preset_mode_value_template: '{{ value | replace("3,0", "turtle") | replace("3,1", "low") | replace("3,2", "medium") | replace("3,3", "high") }}'
    preset_mode_command_topic: "cmnd/family_room_south_fan/tuyasend4"
    preset_mode_command_template: '{{ value | replace("turtle", "3,0") | replace("low", "3,1") | replace("medium", "3,2") | replace("high", "3,3") }}'
    preset_modes:
      - "turtle"
      - "low"
      - "medium"
      - "high"
    payload_available: "Online"
    payload_not_available: "Offline"
    payload_on: "ON"
    payload_off: "OFF"
    unique_id: family_room_fan_south
# Lights
light:
  - name: "Master Bath Light"
    state_topic: "stat/MB_Bath_Light/POWER"
    command_topic: "cmnd/MB_Bath_Light/POWER"
    availability_topic: "tele/MB_Bath_Light/LWT"
    brightness_state_topic: "stat/MB_Bath_Light/RESULT"
    brightness_command_topic: "cmnd/MB_Bath_Light/Dimmer"
    brightness_scale: 100
    brightness_value_template: "{{ value_json.Dimmer }}"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false
    unique_id: master_bath_light
  - name: "Eric Office Light"
    state_topic: "stat/EricOfficeLight/POWER"
    command_topic: "cmnd/EricOfficeLight/POWER"
    availability_topic: "tele/EricOfficeLight/LWT"
    brightness_state_topic: "stat/EricOfficeLight/RESULT"
    brightness_command_topic: "cmnd/EricOfficeLight/Dimmer"
    brightness_scale: 100
    brightness_value_template: "{{ value_json.Dimmer }}"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false
    unique_id: EricOfficeLight
  # Den Stairs - 3 Way
  - name: "Den Stair Landing"
    state_topic: "stat/tasmota_245E58/POWER1"
    command_topic: "cmnd/tasmota_245E58/EVENT"
    availability_topic: "tele/tasmota_245E58/LWT"
    qos: 0
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false
    unique_id: DenStairLanding
  # Shelly LED Strip Lights
  - name: CD Shelf Dimmer
    schema: template
    state_topic: "shellies/cd-shelf-dimmer/light/0/status"
    state_template: "{% if value_json.ison %} on {% else %} off {% endif %}"
    command_topic: "shellies/cd-shelf-dimmer/light/0/set"
    command_on_template: '{"turn": "on"{% if brightness is defined %}, "brightness": {{(brightness | float * 0.3882 + 1) | round(0)}}{% endif %}}'
    command_off_template: '{"turn": "off"}'
    brightness_template: "{{ (value_json.brightness | float * 2.55) | round(0) }}"
    retain: false
    unique_id: cd_shelf_dimmer
  # Shelly Switches
  - name: "Basement Landing Lights"
    command_topic: "shellies/basement-landing-lights/relay/0/command"
    state_topic: "shellies/basement-landing-lights/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/basement-landing-lights/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: basement-landing-lights
    qos: 0
  - name: "Basement Lights - North"
    command_topic: "shellies/basement-lights-north/relay/0/command"
    state_topic: "shellies/basement-lights-north/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/basement-lights-north/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: basement-lights-north
    qos: 0
  - name: "Basement Lights - South"
    command_topic: "shellies/basement-lights-south/relay/0/command"
    state_topic: "shellies/basement-lights-south/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/basement-lights-south/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: basement-lights-south
    qos: 0
  - name: "Garage Lights - North"
    command_topic: "shellies/garage-lights-north/relay/0/command"
    state_topic: "shellies/garage-lights-north/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/garage-lights-north/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: garage-lights-north
    qos: 0
  - name: "Garage Lights - South"
    command_topic: "shellies/garage-lights-south/relay/0/command"
    state_topic: "shellies/garage-lights-south/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/garage-lights-south/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: garage-lights-south
    qos: 0
  - name: "Nicole Office Wall Switch"
    command_topic: "shellies/nicole-office-wall-switch/relay/0/command"
    state_topic: "shellies/nicole-office-wall-switch/relay/0"
    payload_on: "on"
    payload_off: "off"
    availability_topic: "shellies/nicole-office-wall-switch/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    unique_id: nicole-office-wall-switch
    qos: 0
# Sensors    
sensor:
  - name: "Energy Bridge"
    icon: mdi:home-lightning-bolt
    state_topic: "event/metering/summation/minute"
    unit_of_measurement: "W"
    value_template: "{{ value_json.value }}"
    state_class: total
    unique_id: energy_bridge
  - name: "Energy Bridge - Kwh" #Converts the W vaule int Kwh, for energy dashboard
    icon: mdi:home-lightning-bolt
    state_topic: "event/metering/summation/minute"
    unit_of_measurement: "kWh"
    value_template: "{{ value_json.value | float / 60000 }}"
    last_reset_value_template: "{{ now().fromtimestamp(value_json.time / 1000).replace(tzinfo=now().tzinfo) }}"
    device_class: energy
    state_class: total
    unique_id: energy_bridge_kwh
