- id: home_mode_away
  alias: Home Mode - Set away when everyone leaves
  description: ''
  triggers:
  - entity_id: group.people
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
    alias: When everyone is away for more than five minutes
  conditions: []
  actions:
  - action: script.goodbye
    metadata: {}
    data: {}
  mode: parallel
  max: 10
- id: welcome_home
  alias: Welcome Home
  description: ''
  triggers:
  - entity_id: group.people
    to: home
    trigger: state
  - entity_id: person.eric
    to: home
    trigger: state
  - entity_id: person.nicole
    to: home
    trigger: state
  conditions: []
  actions:
  - action: lock.unlock
    metadata: {}
    data: {}
    target:
      entity_id: lock.kitchen_door_lock
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: input_select.home_mode
        state: Sleep
      alias: Mode is not Sleep
    then:
    - data:
        option: Home
      target:
        entity_id: input_select.home_mode
      action: input_select.select_option
      alias: Set mode to home
    - data: {}
      target:
        entity_id: switch.magic_mirror_screen
      action: switch.turn_on
  - if:
    - alias: If it's dark outside
      condition: or
      conditions:
      - condition: sun
        after: sunset
        after_offset: '-1:00'
        before: sunrise
      - condition: state
        entity_id: binary_sensor.pixel_post_light_on
        state: 'on'
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.kitchen_table_light
        - light.kitchen_mudroom_dimmer
        - light.dining_room_table_dimmer
  mode: parallel
  max: 10
- id: goodnight_2am
  alias: Scene - Goodnight at 2:00am
  description: ''
  triggers:
  - at: 02:00:00
    trigger: time
  conditions:
  - condition: state
    entity_id: group.people
    state: home
    alias: Someone is home
  actions:
  - action: script.goodnight
    metadata: {}
    data: {}
  mode: single
- id: watch_tv_after_sunset
  alias: Scene - Trigger watch TV when Remote goes from PowerOff after sunset
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.downstairs_musiccast
    to: playing
  conditions:
  - condition: time
    after: '19:00:00'
  actions:
  - action: script.watch_tv_downstairs
    metadata: {}
    data: {}
  - if:
    - condition: state
      entity_id: binary_sensor.kitchen_motion_sensor_occupancy
      state: 'off'
    then:
    - action: script.watch_tv_main_floor
      metadata: {}
      data: {}
  mode: single
- id: basement_lights_single_switch
  alias: Basement - Control lights with single switch
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.basement_stairs_switch
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.basement_stairs_switch
        state: 'off'
      sequence:
      - data: {}
        target:
          area_id: basement
        action: light.turn_off
    - conditions:
      - condition: state
        entity_id: light.basement_stairs_switch
        state: 'on'
      sequence:
      - data: {}
        target:
          entity_id:
          - light.basement_landing_lights
          - light.basement_lights_north
          - light.basement_lights_south
        action: light.turn_on
        alias: Turn on basement lights
    default: []
  mode: single
- id: nicole_office_motion
  alias: Nicole Office - Turn off lights when no one in office
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.nicole_office_sensor_home_security_motion_detection
    to: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.nicole_office_wall_switch
    action: light.turn_off
    alias: Turn off office lights
  mode: single
- id: notify_smoke_detected
  alias: Notification - Smoke Detector Activated
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.basement_smoke_detector_smoke_alarm_smoke_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.basement_smoke_detector_co_alarm_carbon_monoxide_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.eric_office_smoke_detector_smoke_alarm_smoke_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.eric_office_smoke_detector_co_alarm_carbon_monoxide_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.downstairs_smoke_detector_smoke_alarm_smoke_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.downstairs_smoke_detector_co_alarm_carbon_monoxide_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.upstairs_smoke_detector_smoke_alarm_smoke_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.upstairs_smoke_detector_co_alarm_carbon_monoxide_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_smoke_detector_smoke_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_smoke_detector_carbon_monoxide_detected
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.workshop_smoke_and_carbon_monoxide_alarm_smoke_alarm_smoke_detected
    to: 'on'
  conditions: []
  actions:
  - data:
      message: Smoke detector has been activiated.
      title: Smoke Detector Activated!
      data:
        url: /lovelace/alarms
    action: notify.notify_nicole_and_eric
  mode: single
- id: master_bath_motion
  alias: Master Bathroom - Turn off lights when no motion detected
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.master_bathroom_sensor_home_security_motion_detection
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.master_bath_light
    action: light.turn_off
  mode: single
- id: vacation_lighting
  alias: Blueprint - Vacation Lighting
  description: ''
  use_blueprint:
    path: vacation_lighting.yaml
    input:
      vacation_mode_toggle: input_boolean.vacation_mode
      default_brightness: 100
      replay_sensor_1: sensor.replay_basement_lights
      light_target_1: group.basement_lights
      replay_sensor_2: sensor.replay_dining_room_dimmer
      light_target_2: light.dining_room_table_dimmer
      replay_sensor_3: sensor.replay_eric_office_light
      light_target_3: light.eric_office_light
      replay_sensor_4: sensor.replay_family_room_track_light_front
      light_target_4: group.family_room_lights
      replay_sensor_5: sensor.replay_garage_lights
      light_target_5: group.garage_lights
      replay_sensor_6: sensor.replay_kitchen_overhead_lights
      light_target_6: group.kitchen_lights
      replay_sensor_7: sensor.replay_living_room_wall_dimmer
      light_target_7: light.living_room_wall_dimmer
      replay_sensor_8: sensor.replay_kitchenette_spot_lights
      light_target_8: group.den_lights
      replay_sensor_9: sensor.replay_master_bath_light
      light_target_9: light.master_bath_light
      replay_sensor_10: sensor.replay_nicole_office_lights
      light_target_10: light.nicole_office_wall_switch
- id: mini_cool_after_ride
  alias: Mini - Cool car after ride
  description: ''
  triggers:
  - entity_id:
    - device_tracker.cooper_se
    to: Hickory Glen
    for:
      hours: 0
      minutes: 40
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.cooper_se
    to: Milford Trail
    for:
      hours: 0
      minutes: 45
      seconds: 0
    trigger: state
  - entity_id:
    - device_tracker.cooper_se
    to: Tree Farm
    for:
      hours: 0
      minutes: 45
      seconds: 0
    trigger: state
  conditions:
  - condition: template
    value_template: '{{state_attr("weather.ecobee_thermostat", "temperature") >= 70}}'
    alias: Temperature is above 70
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.cooper_se_activate_air_conditioning
  mode: single
- id: vacation_mode_auto
  alias: Vacation Mode
  description: ''
  triggers:
  - entity_id:
    - input_boolean.vacation_mode
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'on'
      sequence:
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.workshop_hvac
      - metadata: {}
        data: {}
        target:
          entity_id: cover.all_shades
        action: cover.close_cover
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_floor_tv
      - action: media_player.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: media_player.main_floor_musiccast
      - action: remote.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: remote.family_room_remote
  mode: single
- id: nicole_office_lights_off
  alias: Nicole Office - Control lights with wall switch
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.nicole_office_wall_switch
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.nicole_office_wall_switch
        state: 'off'
      sequence:
      - data: {}
        action: light.turn_off
        target:
          entity_id:
          - light.nicole_office_closet_light
          - light.nicole_office_wall_switch
          - light.nicole_office_floor_lamp
          - light.raccoon_lamp
    - conditions:
      - condition: state
        entity_id: light.nicole_office_wall_switch
        state: 'on'
      sequence:
      - data: {}
        action: light.turn_on
        target:
          entity_id:
          - light.nicole_office_floor_lamp
          - light.raccoon_lamp
  mode: restart
- id: niocole_office_closet_light
  alias: Nicole Office - Turn closet light off/on with door
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.nicole_office_closet_door
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.nicole_office_closet_door
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.nicole_office_closet_light
    - conditions:
      - condition: state
        entity_id: binary_sensor.nicole_office_closet_door
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.nicole_office_closet_light
        data: {}
  mode: single
- id: set_family_room_thermostat
  alias: Family Room Thermostat
  description: ''
  triggers:
  - entity_id:
    - climate.ecobee_thermostat
    trigger: state
  - entity_id:
    - input_select.home_mode
    trigger: state
  - hours: /1
    alias: Every hour
    trigger: time_pattern
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      state: 'off'
      entity_id: input_boolean.hvac_override
  actions:
  - if:
    - condition: and
      conditions:
      - condition: device
        device_id: 80e2ea7676adeea018b6e96cb57a3af5
        domain: climate
        entity_id: 54b1fea52a0a813e5b05b1655dfba00b
        type: is_hvac_mode
        hvac_mode: heat
        alias: Ecobee is heating
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.home_mode
          state: Sleep
        - condition: state
          entity_id: input_select.home_mode
          state: Wind Down
        alias: If Home Mode is Sleep or Wind Down
    then:
    - action: climate.set_temperature
      metadata: {}
      data:
        temperature: 60
      target:
        entity_id: climate.family_room_thermostat
    else:
    - data:
        main_thermostat: climate.ecobee_thermostat
        fr_thermostat: climate.family_room_thermostat
      alias: Set based on ecobee
      action: python_script.set_fr_thermostat
  mode: restart
- id: kitchette_leds_with_wall_switch
  alias: Kitchenette - Turn on LEDs with wall switch
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.kitchenette_spot_lights
    to: 'on'
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.kitchenette_led_strip
  mode: single
- id: notify_oven_on
  alias: Notification - Everyone left or is sleeping but oven is on.
  description: ''
  triggers:
  - entity_id:
    - group.people
    to: away
    trigger: state
  - entity_id:
    - input_select.home_mode
    to: Sleep
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.oven_oven_machine_state
      state: ready
  actions:
  - data:
      message: Oven is on!
    action: notify.notify_nicole_and_eric
  mode: single
- id: set_dte_peak_month
  alias: Set DTE Peak Month
  description: ''
  triggers:
  - event: start
    trigger: homeassistant
  - at: 00:00:01
    trigger: time
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{((now().month > 5) and (now().month < 10)) and (now().isoweekday()
        < 6)}}'
      alias: Current month is between June and September and it's a weekday
    then:
    - data: {}
      target:
        entity_id: input_boolean.dte_peak_season
      action: input_boolean.turn_on
    else:
    - data: {}
      target:
        entity_id: input_boolean.dte_peak_season
      action: input_boolean.turn_off
  mode: single
- id: notify_fridge_open
  alias: Notification - Upstairs fridge is open.
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.upstairs_refrigerator_door
    for:
      hours: 0
      minutes: 2
      seconds: 0
    to: 'on'
  conditions: []
  actions:
  - data:
      message: Upstairs refrigerator is open.
    action: notify.notify_nicole_and_eric
  mode: single
- id: mini_preconditon_after_work
  alias: Mini - Precondition after work.
  description: ''
  triggers:
  - at: '15:00:00'
    trigger: time
  conditions:
  - condition: or
    conditions:
    - condition: zone
      entity_id: device_tracker.cooper_se
      zone: zone.itc
    - condition: zone
      entity_id: device_tracker.cooper_se
      zone: zone.itc_ann_arbor
    alias: MINI is at work
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.cooper_se_activate_air_conditioning
  - action: lock.unlock
    metadata: {}
    data: {}
    target:
      entity_id: lock.cooper_se_lock
  mode: single
- id: kitchen_window_seat_light
  alias: Kitchen - Control lights with overhead switch
  description: ''
  triggers:
  - entity_id:
    - light.kitchen_overhead_lights
    to: 'on'
    from: 'off'
    trigger: state
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - entity_id:
    - light.kitchen_overhead_lights
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.home_mode
      state: Sleep
    - condition: state
      entity_id: input_select.home_mode
      state: Away
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.kitchen_overhead_lights
        state: 'on'
      sequence:
      - data: {}
        target:
          entity_id:
          - light.kitchen_mudroom_dimmer
          - light.kitchen_sink_dimmer
          - light.kitchen_table_light
          - light.kitchen_under_cabinet_lights
          - light.kitchen_window_seat_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: light.kitchen_overhead_lights
        state: 'off'
      sequence:
      - data: {}
        target:
          entity_id: light.kitchen_window_seat_light
        action: light.turn_off
  mode: queued
  max: 5
- id: notify_dishwasher_complete
  alias: 'Notification - Dishwasher finished '
  description: ''
  triggers:
  - entity_id:
    - sensor.dishwasher_operation_state
    to: Finished
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      message: Dishwasher finished.
      data:
        url: /lovelace/chores
    action: notify.notify_nicole_and_eric
  mode: single
- id: notify_eric_left_work
  alias: Notification - Notify Nicole when Eric leaves work.
  description: ''
  triggers:
  - entity_id: person.eric
    zone: zone.itc
    event: leave
    trigger: zone
  - entity_id: person.eric
    zone: zone.itc_ann_arbor
    event: leave
    trigger: zone
  conditions: []
  actions:
  - data:
      message: Eric is leaving work.
      data:
        url: /map/0
    action: notify.mobile_app_nicole_iphone
  mode: single
- id: notify_water_detected
  alias: Notification - Notify when water sensor detects moisture
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.hot_water_heater_flood_sensor_water_leak_state
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.master_bath_water_sensor_moisture
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_sink_water_sensor
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.laundry_room_water_sensor_iaszone
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.green_bath_water_sensor_moisture
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.orange_bath_water_sensor
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.half_bath_moisture_sensor_moisture
    to: 'on'
  conditions: []
  actions:
  - data:
      message: '{{ trigger.to_state.attributes.friendly_name }} started detecting
        moisture.'
      data:
        url: /lovelace/alarms
    action: notify.notify_nicole_and_eric
  mode: single
- id: half_bath_lights_motion
  alias: Half Bath - Control lights with motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.half_bath_motion_sensor
  - trigger: state
    entity_id:
    - binary_sensor.half_bath_motion_sensor_occupancy
  conditions:
  - condition: state
    entity_id: input_select.home_mode
    state: Home
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.half_bath_motion_sensor_occupancy
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.half_bath_light
    - conditions:
      - condition: state
        entity_id: binary_sensor.half_bath_motion_sensor_occupancy
        state: 'on'
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.half_bath_light
        data: {}
  mode: restart
- id: good_morning_nicole
  alias: Nicole - Good Morning Nicole
  description: ''
  triggers:
  - entity_id:
    - input_button.good_morning_nicole
    alias: When Good Morning Nicole button is pressed
    trigger: state
  conditions:
  - condition: state
    entity_id: person.nicole
    state: home
  actions:
  - action: script.good_morning
    metadata: {}
    data: {}
  mode: single
- id: nicole_wind_down
  alias: Nicole - Wind Down
  description: ''
  triggers:
  - entity_id:
    - input_button.wind_down_nicole
    alias: When Wind Down Nicole Button is pressed
    trigger: state
  conditions:
  - condition: state
    entity_id: person.nicole
    state: home
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.wind_down_nicole
  mode: single
- id: good_morning_eric
  alias: Eric - Good Morning Eric
  description: ''
  triggers:
  - entity_id:
    - input_button.good_morning_eric
    trigger: state
  conditions:
  - condition: state
    entity_id: person.eric
    state: home
  actions:
  - action: script.good_morning
    metadata: {}
    data: {}
  mode: single
- id: garage_door_lights_with_door
  alias: Garage - Turn on Garage Lights when Garage Door opens
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - cover.garage_door
    to: open
  - trigger: state
    entity_id:
    - cover.garage_door
    to: opening
  - trigger: state
    entity_id:
    - cover.garage_door
    to: closed
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - choose:
    - conditions:
      - alias: If Garage Door is Open or Opening
        condition: or
        conditions:
        - condition: state
          entity_id: cover.garage_door
          state: open
        - condition: state
          entity_id: cover.garage_door
          state: opening
      - condition: state
        entity_id: binary_sensor.pixel_post_light_on
        state: 'on'
      sequence:
      - data: {}
        target:
          entity_id:
          - light.garage_lights_north
          - light.garage_lights_south
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: cover.garage_door
        state: closed
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.garage_lights_north
          - light.garage_lights_south
        data: {}
  mode: single
- id: mini_quota_workaround
  alias: MINI - Workaround for Quota
  description: ''
  triggers:
  - minutes: /15
    trigger: time_pattern
  - entity_id: person.nicole
    zone: zone.hickory_glen
    event: enter
    trigger: zone
  - entity_id: person.nicole
    zone: zone.milford_trail
    event: enter
    trigger: zone
  - entity_id: person.nicole
    zone: zone.tree_farm
    event: enter
    trigger: zone
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: device_tracker.cooper_se
    action: homeassistant.update_entity
  mode: single
- id: hair_straightener_off_30_minutes
  alias: Hair Straightener - Turn off after 30 minutes
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - switch.hair_straightener
    to: 'on'
    for:
      hours: 0
      minutes: 30
      seconds: 0
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.hair_straightener_energy_power
      state: '0'
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.hair_straightener
  mode: single
- id: lighting_eric_office_no_motion
  alias: Lighting - Turn off Eric Office lights when no motion detected.
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.eric_office_motion_sensor_motion
    to: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.eric_office_light
    action: light.turn_off
  mode: single
- id: set_ecobee_dte_update
  alias: Climate - Set Ecobee Thermostat
  description: ''
  triggers:
  - entity_id: binary_sensor.day
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.dusk
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.night
    to: 'on'
    trigger: state
  - entity_id: input_select.home_mode
    trigger: state
  - entity_id:
    - binary_sensor.windows
    enabled: true
    trigger: state
  - entity_id:
    - schedule.dte_peak_hours
    trigger: state
  - entity_id:
    - input_boolean.dte_peak_season
    trigger: state
  - hours: /1
    alias: Every hour
    trigger: time_pattern
  - entity_id:
    - climate.ecobee_thermostat
    from: unavailable
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.vacation_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.hvac_override
    state: 'off'
  actions:
  - data:
      weather: weather.ecobee_thermostat
      thermostat: climate.ecobee_thermostat
    action: python_script.set_ecobee
  mode: restart
- id: notify_oven_preheated
  alias: Notification - Notify when oven is done preheating
  description: ''
  triggers:
  - entity_id:
    - sensor.oven_oven_job_state
    from: preheat
    to: cooking
    trigger: state
  conditions: []
  actions:
  - data:
      message: Oven is preheated.
    action: notify.notify_nicole_and_eric
  mode: single
- id: lighting_basement_lights_with_door
  alias: Lighting - Turn on basement lights when door opened.
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.basement_outside_door
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.basement_door
    to: 'on'
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: light.basement_stairs_switch
    action: light.turn_on
  mode: single
- id: set_dimmers_max_during_day
  alias: Lighting - Set dimmers to max brightness when turned on during day.
  description: ''
  triggers:
  - entity_id:
    - light.dining_room_table_dimmer
    to: 'on'
    from: 'off'
    trigger: state
  - entity_id:
    - light.dining_room_wall_dimmer
    to: 'on'
    from: 'off'
    trigger: state
  - entity_id:
    - light.fireplace_dimmer
    to: 'on'
    from: 'off'
    trigger: state
  - entity_id:
    - light.kitchen_mudroom_dimmer
    to: 'on'
    from: 'off'
    trigger: state
  - entity_id:
    - light.kitchen_sink_dimmer
    to: 'on'
    from: 'off'
    trigger: state
  - entity_id:
    - light.living_room_wall_dimmer
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.kitchen_under_cabinet_lights
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.kitchen_table_light
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.family_room_track_light_back
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.family_room_track_light_front
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.kitchenette_led_strip
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.kitchenette_spot_lights
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.master_bath_light
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.master_bedroom_light
    from: 'off'
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - light.nightstand_lamps
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - light.orange_bathroom_lights
    from: 'off'
    to: 'on'
  conditions:
  - condition: and
    conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: input_select.home_mode
        state: Sleep
    - condition: time
      before: '19:00:00'
      after: 03:00:00
  actions:
  - action: light.turn_on
    target:
      entity_id: '{{ trigger.entity_id }}'
    data:
      brightness_pct: 100
  mode: parallel
  max: 13
- id: notify_low_battery
  alias: Blueprint - Low battery level notification
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      actions:
      - data:
          message: Low battery detected for {{sensors}}.
          data:
            url: /lovelace/system
        action: notify.mobile_app_nicole_iphone
      exclude:
        entity_id:
        - sensor.cooper_se_charging_level_hv
        - sensor.erics_iphone_14_battery_level
        - sensor.roomba_battery_level
        - sensor.roomba_mainfloor_battery_level
        - sensor.nicole_iphone_battery_level
        - sensor.erics_iphone_14_watch_battery
        - binary_sensor.front_door_lock_low_battery_level
        - binary_sensor.front_door_lock_replace_battery_now
        - binary_sensor.front_door_lock_replace_battery_soon
      time: '11:00:00'
      threshold: 30
- id: vacation_mode_start_vacuum
  alias: Vacation - Vacuum at 8am
  description: ''
  triggers:
  - at: 08:00:00
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  actions:
  - data: {}
    target:
      entity_id:
      - vacuum.roborock_main_floor
      - vacuum.roomba
      - vacuum.roomba_mainfloor
    action: vacuum.start
  mode: single
- id: notify_lower_blinds_hvac
  alias: Cover - Put down blinds when HVAC is AC
  description: ''
  triggers:
  - at: '15:00:00'
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: not
      conditions:
      - condition: time
        weekday:
        - sat
        - sun
  - condition: state
    entity_id: climate.ecobee_thermostat
    state: cool
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.kitchen_window
      state: 'on'
    then:
    - metadata: {}
      data: {}
      target:
        entity_id:
        - cover.living_room_shades_center_cover
        - cover.dining_room_shades_cover
      action: cover.close_cover
    else:
    - metadata: {}
      data: {}
      target:
        entity_id: cover.all_shades
      action: cover.close_cover
  mode: single
- id: utility_lights_door
  alias: Lighting - Control utility room lights with door.
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.utility_room_doors
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.utility_room_doors
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.utility_room_light
    - conditions:
      - condition: state
        entity_id: binary_sensor.utility_room_doors
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.utility_room_light
        data: {}
  mode: single
- id: lights_on_post_light
  alias: Outdoor Lights - Control lights with Pixel Post
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.pixel_post_light_on
    to: 'on'
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.pixel_post_light_on
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.home_mode
      state: Sleep
    alias: Mode is not Sleep
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.pixel_post_light_on
          state: 'on'
      sequence:
      - data: {}
        action: light.turn_on
        target:
          entity_id:
          - light.outdoor_garage_lights
          - light.garage_flood_lights_west
          - light.service_door_light
          - light.porch_light
          - light.outside_workshop_light
          - light.driveway_post_and_tree_lights
          - light.family_room_deck_light_side
      - action: script.holiday_lighting
        metadata: {}
        data: {}
      - if:
        - condition: state
          entity_id: remote.family_room_remote
          state: 'off'
        then:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - light.family_room_deck_light_back
            - light.grill_lights
      alias: If Pixel Post is on and mode is not Sleep
    - conditions:
      - condition: state
        entity_id: binary_sensor.pixel_post_light_on
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: outdoors
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.pixel_post_light
  mode: single
- id: den_lights_wall_switch
  alias: Lighting - Control Den Step Lights with Wall Switch
  description: ''
  triggers:
  - entity_id:
    - light.den_stair_landing
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.den_stair_landing
        state: 'on'
      sequence:
      - data:
          brightness: 255
        target:
          entity_id: light.step_lights
        action: light.turn_on
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: light.den_stair_landing
          state: 'off'
        - condition: state
          entity_id: remote.family_room_remote
          state: 'off'
      sequence:
      - data: {}
        target:
          entity_id: light.step_lights
        action: light.turn_off
  mode: single
- id: kitchen_speakers_airplay
  alias: Kitchen - MuiscCast speakers to kitchen when source is airplay.
  description: ''
  triggers:
  - entity_id:
    - media_player.main_floor_musiccast
    attribute: source
    id: MainFloorMusicCastAirplay
    to: AirPlay
    trigger: state
  - entity_id:
    - media_player.main_floor_musiccast
    attribute: source
    id: MainFloorMusicCastNotAirplay
    from: AirPlay
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - MainFloorMusicCastAirplay
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_floor_musiccast_speaker_a
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_floor_musiccast_speaker_b
    - conditions:
      - condition: trigger
        id:
        - MainFloorMusicCastNotAirplay
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_floor_musiccast_speaker_a
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_floor_musiccast_speaker_b
  mode: single
- id: lighting_turn_off_bedroom_closet_light_with_overhead_light
  alias: Lighting - Turn off bedroom closet light with overhead light
  description: ''
  triggers:
  - entity_id:
    - light.master_bedroom_light
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - metadata: {}
    data: {}
    action: light.turn_off
    target:
      entity_id: light.master_bedroom_closet
  mode: single
- id: notify_workshop_lock_jammed
  alias: Notify - Workshop lock jammed
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.workshop
    to: jammed
  conditions: []
  actions:
  - data:
      message: Issue with Workshop Lock. Check if door is closed.
      data:
        url: /lovelace/doors-and-windows
    action: notify.notify_nicole_and_eric
  mode: single
- id: lighting_turn_on_lava_lamp_on_eric_wfh_days
  alias: Turn on Lava Lamp on Eric WFH Days
  description: ''
  triggers:
  - at: 04:00:00
    trigger: time
  conditions:
  - condition: state
    state: 'on'
    entity_id: binary_sensor.eric_at_home_workday_sensor
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.lava_lamp
  mode: single
- id: turn_off_lava_lamp_at_4_00pm
  alias: Turn Off Lava Lamp at 4:00PM
  description: ''
  triggers:
  - at: '16:00:00'
    trigger: time
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.lava_lamp
  mode: single
- id: cover_open_shades_when_sun_sets
  alias: Cover - Open shades when sun sets
  description: ''
  triggers:
  - event: sunset
    offset: 0
    trigger: sun
  - at: '19:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.vacation_mode
    state: 'off'
  actions:
  - metadata: {}
    data: {}
    target:
      entity_id: cover.all_shades
    action: cover.open_cover
  mode: single
- id: turn_off_dehumidifiers_during_peak_hours
  alias: Turn Off Dehumidifiers and turn up fan during peak hours
  description: ''
  triggers:
  - entity_id:
    - schedule.dte_peak_hours
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.dte_peak_season
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'on'
      sequence:
      - metadata: {}
        data:
          percentage: 100
        target:
          entity_id: fan.master_bedroom_fan
        action: fan.set_percentage
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.dehumidifier
          - switch.rock_tumbler
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.raccoon_lamp
          - light.nicole_office_floor_lamp
      - action: fan.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: fan.family_room_fan_south
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'off'
      - condition: state
        entity_id: binary_sensor.windows
        state: 'off'
      sequence:
      - metadata: {}
        data:
          percentage: 25
        target:
          entity_id: fan.master_bedroom_fan
        action: fan.set_percentage
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.rock_tumbler
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.family_room_fan_south
      - if:
        - condition: state
          entity_id: binary_sensor.windows
          state: 'off'
        then:
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: switch.dehumidifier
  mode: single
- id: dehumidifier_turn_off_when_windows_open
  alias: Dehumidifier & Air Purifiers - Turn off when windows open
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.windows
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.windows
        state: 'on'
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.dehumidifier
          - switch.dining_room_air_purifier
          - switch.bedroom_air_purifier
          - switch.nicole_office_air_purifier
      - alias: Turn off thermostat
        action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: 'off'
        target:
          entity_id:
          - climate.ecobee_thermostat
          - climate.family_room_thermostat
    - conditions:
      - condition: state
        entity_id: binary_sensor.windows
        state: 'off'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.dehumidifier
          - switch.dining_room_air_purifier
          - switch.bedroom_air_purifier
          - switch.nicole_office_air_purifier
  mode: single
- id: doorbell_snapshot
  alias: Notify on doorbell ring.
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_visitor
    to: 'on'
  conditions: []
  actions:
  - target:
      entity_id: camera.doorbell_fluent
    data:
      filename: /config/www/doorbell/{{ expand('binary_sensor.doorbell_visitor')[0].last_changed
        | as_timestamp  | timestamp_custom("%Y-%m-%d_%H-%M-%S") }}.jpg
    action: camera.snapshot
  - data:
      data:
        attachment:
          content-type: jpg
          hide-thumbnail: false
          url: /local/doorbell/{{ expand('binary_sensor.doorbell_visitor')[0].last_changed
            | as_timestamp  | timestamp_custom("%Y-%m-%d_%H-%M-%S") }}.jpg
        url: /lovelace/cameras
      message: Someone is at the front door.
    enabled: true
    action: notify.notify_nicole_and_eric
  - metadata: {}
    data:
      message: '![image](/local/doorbell/{{ expand(''binary_sensor.doorbell_visitor'')[0].last_changed
        | as_timestamp  | timestamp_custom("%Y-%m-%d_%H-%M-%S") }}.jpg)'
      title: Someone is at the door.
    action: notify.persistent_notification
  mode: single
- id: notify_on_package_delivery
  alias: Notify on package delivery
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_package
    to: 'on'
  conditions: []
  actions:
  - metadata: {}
    data:
      message: 'A package has been delivered. '
      data:
        url: /lovelace/cameras
    action: notify.notify_nicole_and_eric
  mode: single
- id: switch_master_bedroom_fan_direction_with_hvac_mode
  alias: Switch Master Bedroom Fan Direction with HVAC Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - climate.ecobee_thermostat
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: climate.ecobee_thermostat
        state: cool
      sequence:
      - metadata: {}
        data:
          direction: reverse
        target:
          entity_id: fan.master_bedroom_fan
        alias: Set fan to reverse
        action: fan.set_direction
      alias: When Ecobee is cooling switch fan to reverse
    - conditions:
      - condition: state
        entity_id: climate.ecobee_thermostat
        state: heat
      sequence:
      - alias: Set bedroom fan to forward
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.master_bedroom_fan
        action: fan.set_direction
      alias: When Ecobee is heating switch fan to forward
  mode: single
- id: control_closet_room_lights_with_wall_switch
  alias: Control Closet Room Lights with wall switch
  description: ''
  triggers:
  - entity_id:
    - light.closet_room_wall_switch
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.closet_room_wall_switch
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.closet_room_closet_light
    - conditions:
      - condition: state
        entity_id: light.closet_room_wall_switch
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.closet_room_closet_light
        data: {}
  mode: single
- id: bedroom_control_nightstand_lamps_with_wall_switch
  alias: Bedroom - Control nightstand lamps with wall switch
  description: ''
  triggers:
  - entity_id:
    - light.master_bedroom_light
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - light.master_bedroom_light
    from: 'on'
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.master_bedroom_light
        state: 'on'
      - condition: time
        before: '20:00:00'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.nightstand_lamps
    - conditions:
      - condition: state
        entity_id: light.master_bedroom_light
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.nightstand_lamps
        data: {}
  mode: single
- id: closet_room_control_lights_with_motion
  alias: Closet Room - Control Lights with Motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.closet_room_motion_sensor_motion
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.closet_room_motion_sensor_occupancy
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.closet_room_motion_sensor_motion
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.closet_room_wall_switch
    - conditions:
      - condition: state
        entity_id: binary_sensor.closet_room_motion_sensor_occupancy
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.closet_room_wall_switch
  mode: single
- id: bedroom_turn_off_lights_with_motion
  alias: Bedroom - Turn off lights with motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_ecobee_sensor_occupancy
    to: 'off'
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.master_bedroom_light
      - light.master_bedroom_closet
  mode: single
- id: basement_control_basement_lights_with_motion
  alias: Basement - Control basement lights with motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.basement_motion_group
    to: 'off'
    for:
      hours: 0
      minutes: 30
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.basement_motion_group
    to: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.basement_motion_group
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.basement_stairs_switch
    - conditions:
      - condition: state
        entity_id: binary_sensor.basement_motion_group
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.basement_stairs_switch
        data: {}
  mode: single
- id: kitchen_turn_off_lights_with_motion
  alias: Kitchen - Turn off lights with motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_motion_sensor_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: state
    entity_id: binary_sensor.pixel_post_light_on
    state: 'off'
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: kitchen
  mode: single
- id: lights_turn_off_garage_lights_with_no_motion
  alias: Lights - Turn off garage lights with no motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garage_sensor_home_security_motion_detection
    for:
      hours: 0
      minutes: 30
      seconds: 0
    to: 'off'
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.garage_lights_north
      - light.garage_lights_south
  mode: single
- id: outdoor_lights_turn_off_at_sunrise
  alias: Outdoor Lights - Turn off at Sunrise
  description: ''
  triggers:
  - trigger: sun
    event: sunrise
    offset: 0
  conditions:
  - condition: state
    entity_id: binary_sensor.pixel_post_light_on
    state: 'off'
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: outdoors
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: input_select.home_mode
        state: Sleep
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.pixel_post_light
  mode: single
- id: notification_notify_on_low_rinse_aid
  alias: Notification - Notify on low rinse aid
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.dishwasher_rinse_aid_nearly_empty
    from: 'off'
  conditions: []
  actions:
  - action: notify.notify_nicole_and_eric
    metadata: {}
    data:
      message: Add rinse aid to dishwasher.
  mode: single
- id: christmas_tree_on_at_sunset
  alias: Christmas Tree on at Sunset
  description: ''
  triggers:
  - trigger: sun
    event: sunset
    offset: '-1:00'
  conditions: []
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.christmas_tree
  mode: single
- id: climate_workshop_hvac
  alias: Climate - Workshop HVAC
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.workshop_hvac_indoor_temperature
  - trigger: state
    entity_id:
    - input_select.home_mode
    to: Home
  - trigger: state
    entity_id:
    - person.eric
    to: home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{states(''sensor.workshop_hvac_indoor_temperature'')|int
          > 50 }}'
        alias: Workshop temperature is greater than 50
      sequence:
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.workshop_hvac
      alias: Turn off if temperature is greater than 50
    - conditions:
      - condition: and
        conditions:
        - alias: Workshop temperature is less than 40
          condition: template
          value_template: '{{states(''sensor.workshop_hvac_indoor_temperature'')|int
            < 41 }}'
        - condition: state
          entity_id: person.eric
          state: home
          enabled: false
        - condition: state
          entity_id: input_select.home_mode
          state: Home
          enabled: false
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.workshop_hvac
      alias: Eric Home and temp under 40
  mode: single
- id: turn_on_upstairs_nightlight_motion
  alias: Turn on Nightlights with Motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.entryway_nightlight_motion
    id: entryway-nightlight-motion
  - trigger: state
    entity_id:
    - binary_sensor.upstairs_hallway_nightlight_motion
    id: upstairs-nightlight-motion
  - trigger: state
    entity_id:
    - binary_sensor.downstairs_hallway_nightlight_motion
    id: downstairs-nightlight-motion
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - entryway-nightlight-motion
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.entryway_nightlight_motion
            state: 'on'
          - condition: template
            value_template: '{{ float(states(''sensor.entryway_nightlight_illuminance''))
              < 50 }}'
            alias: Luminance is less than 50
        then:
        - action: light.turn_on
          metadata: {}
          data:
            color_temp_kelvin: 2000
            brightness_pct: 50
          target:
            entity_id: light.entryway_nightlight_light
        else:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: light.entryway_nightlight_light
    - conditions:
      - condition: trigger
        id:
        - upstairs-nightlight-motion
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.upstairs_hallway_nightlight_motion
            state: 'on'
          - alias: Luminance is less than 50
            condition: template
            value_template: '{{ float(states(''sensor.upstairs_hallway_nightlight_illuminance''))
              < 20 }}'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            color_temp_kelvin: 2000
            brightness_pct: 50
          target:
            entity_id:
            - light.upstairs_hallway_nightlight_light
        else:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: light.upstairs_hallway_nightlight_light
    - conditions:
      - condition: trigger
        id:
        - downstairs-nightlight-motion
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.downstairs_hallway_nightlight_motion
            state: 'on'
          - alias: Luminance is less than 50
            condition: template
            value_template: '{{ float(states(''sensor.downstairs_hallway_nightlight_illuminance''))
              < 50 }}'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            color_temp_kelvin: 2000
            brightness_pct: 50
          target:
            entity_id: light.downstairs_hallway_nightlight_light
        else:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: light.downstairs_hallway_nightlight_light
  mode: restart
- id: control_eric_office_closet_lights_with_door
  alias: Control Eric Office Closet Lights with Door
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.eric_office_closet_door_right_opening
    id: eric-closet-door-right-changed
  - trigger: state
    entity_id:
    - binary_sensor.eric_office_closet_door_left_opening
    id: eric-closet-door-left-changed
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - eric-closet-door-right-changed
      sequence:
      - if:
        - condition: state
          entity_id: binary_sensor.eric_office_closet_door_right_opening
          state: 'on'
        then:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.eric_office_closet_right_light
        else:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: light.eric_office_closet_right_light
    - conditions:
      - condition: trigger
        id:
        - eric-closet-door-left-changed
      sequence:
      - if:
        - condition: state
          entity_id: binary_sensor.eric_office_closet_door_left_opening
          state: 'on'
        then:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.eric_office_closet_left_light
        else:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: light.eric_office_closet_left_light
  mode: restart
- id: notify_on_washing_machine_finish
  alias: Notify on washing machine finish
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.washer_job_state
    to: finish
  conditions: []
  actions:
  - action: notify.notify_nicole_and_eric
    metadata: {}
    data:
      message: Washing Machine finished.
  mode: single
- id: control_orange_bathroom_lights_with_motion
  alias: Control Orange Bathroom Lights with Motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.orange_bath_motion_sensor
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.orange_bath_motion_sensor
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.orange_bath_motion_sensor
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.orange_bathroom_lights
    - conditions:
      - condition: state
        entity_id: binary_sensor.orange_bath_motion_sensor
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.orange_bathroom_lights
  mode: single
- id: '1740866658676'
  alias: Control Green Bath Lights with Motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.green_bath_motion_sensor
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.green_bath_motion_sensor
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: state
    entity_id: light.green_bath_tub_dimmer
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.green_bath_motion_sensor
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.green_bath_vanity_lights
    - conditions:
      - condition: state
        entity_id: binary_sensor.green_bath_motion_sensor
        state: 'off'
        for:
          hours: 0
          minutes: 10
          seconds: 0
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.green_bath_tub_dimmer
          - light.green_bath_vanity_lights
  mode: single
- id: '1744658871343'
  alias: 3D Printer Idle Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.3d_printer_current_stage
    to: idle
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - sensor.3d_printer_current_stage
    from: idle
    for:
      hours: 0
      minutes: 0
      seconds: 30
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.3d_printer_current_stage
        state: idle
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.3d_printer_chamber_light
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.3d_printer_enable_camera
      alias: If Idle, turn off light and camera
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.3d_printer_current_stage
          state: idle
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.3d_printer_chamber_light
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.3d_printer_enable_camera
      alias: If not idle, turn on light and camera
  mode: single
- id: '1746476704280'
  alias: Set Energy Meter to Peak or Off Peak
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - schedule.dte_peak_hours
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'on'
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Peak
        target:
          entity_id: select.dte_energy_meter
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'off'
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Off-Peak
        target:
          entity_id: select.dte_energy_meter
  mode: single
- id: '1746546084116'
  alias: Set meter peak and off-peak times
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - schedule.dte_peak_hours
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'on'
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: peak
        target:
          entity_id: select.daily_energy
    - conditions:
      - condition: state
        entity_id: schedule.dte_peak_hours
        state: 'off'
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: offpeak
        target:
          entity_id: select.daily_energy
  mode: single
- id: '1746714428992'
  alias: Turn off AppleTV with MusicCast
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.downstairs_musiccast
    to: 'off'
  conditions: []
  actions:
  - action: remote.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: remote.apple_tv
  mode: single
